(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{207:function(e,s,_){"use strict";_.r(s);var t=_(0),r=Object(t.a)({},(function(){var e=this,s=e.$createElement,_=e._self._c||s;return _("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[_("h1",{attrs:{id:"执行计划"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#执行计划","aria-hidden":"true"}},[e._v("#")]),e._v(" 执行计划")]),e._v(" "),_("p",[e._v("上一篇中介绍了索引，从结果上看，一个查询走索引和不走索引的查询效率的差别，当然这个也很好理解。")]),e._v(" "),_("p",[e._v("生活中的例子有：我们通过各种字典去查单词、生字、成语之类的；在图书馆里每一本书会有一个索引号（A-Z 开头），\n同时对图书进行分类，把不同分类的书籍摆放到不同的楼层和区域；在奶茶门店里店员会将顾客下单的饮品按订单的取茶号（1-9 开头）\n放置在一个取茶的标识架（标识 1-9）里面。")]),e._v(" "),_("p",[e._v("所以在业务系统里面，给经常被搜索的字段加上索引是非常有必要的事情，然而，有时候我们明明建立了索引，但是查询依旧缓慢。这个\n时候我们就需要使用执行计划了，查询执行计划来查看数据库查询时是否走了索引。")]),e._v(" "),_("h3",{attrs:{id:"使用-explain-查看-mysql-执行计划"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#使用-explain-查看-mysql-执行计划","aria-hidden":"true"}},[e._v("#")]),e._v(" 使用 explain 查看 mysql 执行计划")]),e._v(" "),_("p",[_("code",[e._v("explain")]),e._v(" 适用于 "),_("code",[e._v("select")]),e._v(", "),_("code",[e._v("insert")]),e._v(", "),_("code",[e._v("update")]),e._v(" 和 "),_("code",[e._v("delete")]),e._v(" 语句")]),e._v(" "),_("div",{staticClass:"language-mysql extra-class"},[_("pre",{pre:!0,attrs:{class:"language-text"}},[_("code",[e._v("explain select * from `user` where user_sn = '826104d6e34b11e9be1768f72847b82b';\n\n+----+-------------+-------+------------+-------+-------------------------+-------------------------+---------+-------+------+----------+-------+\n| id | select_type | table | partitions | type  | possible_keys           | key                     | key_len | ref   | rows | filtered | Extra |\n+----+-------------+-------+------------+-------+-------------------------+-------------------------+---------+-------+------+----------+-------+\n|  1 | SIMPLE      | user  | NULL       | const | unique_key_user_user_sn | unique_key_user_user_sn | 99      | const |    1 |      100 | NULL  |\n+----+-------------+-------+------------+-------+-------------------------+-------------------------+---------+-------+------+----------+-------+\n")])])]),_("ul",[_("li",[e._v("id 查询序列号")]),e._v(" "),_("li",[e._v("select_type 查询类型")]),e._v(" "),_("li",[e._v("table 输出所引用的表")]),e._v(" "),_("li",[e._v("partitions 匹配的分区")]),e._v(" "),_("li",[e._v("type 连接使用的类型")])]),e._v(" "),_("blockquote",[_("p",[e._v("结果值从好到坏依次是：\nsystem > const > eq_ref > ref > fulltext > ref_or_null > index_merge > unique_subquery > index_subquery > range > index > ALL > UNKNOWN\n也就是说 type 记录了是否使用了索引还是全表扫描，const, eg_reg, ref, range, index, ALL\n一般来说，得保证查询至少达到 range 级别，最好能达到 ref，否则就可能会出现性能问题。")])]),e._v(" "),_("ul",[_("li",[e._v("possible_keys 指出使用到那些索引有助于查询")]),e._v(" "),_("li",[e._v("key 实际选择的索引")]),e._v(" "),_("li",[e._v("key_len 使用索引的长度。在不损失精确性的情况下，长度越短越好")]),e._v(" "),_("li",[e._v("ref 显示索引的那一列被使用了")]),e._v(" "),_("li",[e._v("rows 请求数据的行数")]),e._v(" "),_("li",[e._v("filtered 按表条件过滤行的百分比")]),e._v(" "),_("li",[e._v("Extra 附件信息")])]),e._v(" "),_("blockquote",[_("p",[e._v("特别的 explain 不会考虑 cache；不能显示 mysql 在执行查询时所作的优化工作；部分统计信息是估算的。")])]),e._v(" "),_("p",[e._v("我们删掉 "),_("code",[e._v("user_sn")]),e._v(" 上所有的索引，然后查看一下执行计划")]),e._v(" "),_("div",{staticClass:"language-mysql extra-class"},[_("pre",{pre:!0,attrs:{class:"language-text"}},[_("code",[e._v("explain select * from `user` where user_sn = '826104d6e34b11e9be1768f72847b82b';\n\n+----+-------------+-------+------------+------+---------------+------+---------+------+--------+----------+-------------+\n| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows   | filtered | Extra       |\n+----+-------------+-------+------------+------+---------------+------+---------+------+--------+----------+-------------+\n|  1 | SIMPLE      | user  | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 994143 |       10 | Using where |\n+----+-------------+-------+------------+------+---------------+------+---------+------+--------+----------+-------------+\n")])])]),_("p",[e._v("我们可以看到没有索引的时候 type 为 ALL，也就是全表扫描。 key 是 NULL，也就是说这个查询没有使用到任何索引。")]),e._v(" "),_("p",[e._v("删掉 "),_("code",[e._v("user_sn")]),e._v(" 上所有的索引然后在 "),_("code",[e._v("user_sn")]),e._v(" 建立唯一索引，再查看执行计划：")]),e._v(" "),_("div",{staticClass:"language-mysql extra-class"},[_("pre",{pre:!0,attrs:{class:"language-text"}},[_("code",[e._v("explain select * from `user` where user_sn = '826104d6e34b11e9be1768f72847b82b';\n\n+----+-------------+-------+------------+-------+-------------------------+-------------------------+---------+-------+------+----------+-------+\n| id | select_type | table | partitions | type  | possible_keys           | key                     | key_len | ref   | rows | filtered | Extra |\n+----+-------------+-------+------------+-------+-------------------------+-------------------------+---------+-------+------+----------+-------+\n|  1 | SIMPLE      | user  | NULL       | const | unique_key_user_user_sn | unique_key_user_user_sn | 99      | const |    1 |      100 | NULL  |\n+----+-------------+-------+------------+-------+-------------------------+-------------------------+---------+-------+------+----------+-------+\n")])])]),_("p",[e._v("加了唯一索引之后，type 为 const，key 为 unique_key_user_user_sn 表明这个查询使用到了该索引。")]),e._v(" "),_("p",[e._v("删掉 "),_("code",[e._v("user_sn")]),e._v(" 上所有的索引然后在 "),_("code",[e._v("user_sn")]),e._v(" 建立索引，再查看执行计划：")]),e._v(" "),_("div",{staticClass:"language-mysql extra-class"},[_("pre",{pre:!0,attrs:{class:"language-text"}},[_("code",[e._v("explain select * from `user` where user_sn = '826104d6e34b11e9be1768f72847b82b';\n\n+----+-------------+-------+------------+------+------------------+------------------+---------+-------+------+----------+-------+\n| id | select_type | table | partitions | type | possible_keys    | key              | key_len | ref   | rows | filtered | Extra |\n+----+-------------+-------+------------+------+------------------+------------------+---------+-------+------+----------+-------+\n|  1 | SIMPLE      | user  | NULL       | ref  | key_user_user_sn | key_user_user_sn | 99      | const |    1 |      100 | NULL  |\n+----+-------------+-------+------------+------+------------------+------------------+---------+-------+------+----------+-------+\n")])])]),_("p",[e._v("加了索引之后，type 为 ref 为 key_user_user_sn 表明这个查询使用到了该索引。")])])}),[],!1,null,null,null);s.default=r.exports}}]);